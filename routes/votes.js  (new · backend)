// routes/votes.js — iBand backend: fan votes per artist
const express = require('express');
const router = express.Router();

const {
  addVote,
  getVotesForArtist,
} = require('../services/votesService');

// GET /api/votes/:artistId  → { artistId, total }
router.get('/:artistId', (req, res) => {
  const artistId = String(req.params.artistId || '').trim();
  if (!artistId) return res.status(400).json({ error: 'artistId required' });

  const total = getVotesForArtist(artistId);
  return res.json({ artistId, total });
});

// POST /api/votes/:artistId  { userId? } → { success, artistId, total }
router.post('/:artistId', (req, res) => {
  const artistId = String(req.params.artistId || '').trim();
  if (!artistId) return res.status(400).json({ error: 'artistId required' });

  // optional: userId for soft de-dupe per minute (handled in service)
  const userId = req.body?.userId ? String(req.body.userId) : 'anon';

  const total = addVote({ artistId, userId });
  return res.status(201).json({ success: true, artistId, total });
});

module.exports = router;